# Flu Immunization 2022 Analysis and Visualization

### Purpose: 
This repository will document the creation of the dashboard shown below. 

![Tableau Snapshot](https://github.com/sydflowers/Data-Projects/assets/129544066/191aefda-9985-4819-a699-bdf3913d0cb4)
(https://public.tableau.com/app/profile/sydney3387/viz/ImmunizationDashboard2022_17050113622540/Dashboard1?publish=yes)

### Techniques: 
Tableau Public, SQL (CTE's, Join, Subqueries) using Postgres

### Data Source:
Data was generated by Synthea, an open-source data synthesizer for educational purposes. No real patient data was used for this analysis. The data used for this porject was generated to be similar to real healthcare data, and includes patient names, DOB's, encounter dates, and treatment codes. 

### Code: 

```sql
/* Flu Immunization 2022 Dashboard

Our dasboard should show the following:
1. Total percentage of patients getting flu shots by: 
 - Age
 - Race
 - County (Mapped)
 - Overall
2. Running total of Flu shots over the course of 2022
3. Total # of flu shots given in 2022
4. List of patients that show whether or not they have received the flu shot

Patients must have been 'Active' at our hospital
*/

with active_patients as
(
	select distinct patient
	from encounters as e
	join patients as pat
		on e.patient = pat.id
	where start between '2020-01-01 00:00' and '2022-12-31 12:59'
		and pat.deathdate is null
		and extract(month from age('2022-12-31',pat.birthdate)) >= 6
),

flu_shot_2022 as
(
select patient, min(date) as earliest_flu_shot_2022
from public.immunizations
WHERE code = '5302'
	and date between '2022-01-01 00:00' and '2022-12-31 23:59'
GROUP BY patient 
)

SELECT 	pat.birthdate
		,pat.race
		,pat.county
		,pat.id
		,pat.first
		,pat.last
		,flu.earliest_flu_shot_2022
		,extract(YEAR FROM age('12-31-2022', birthdate)) as age
		,case when flu.patient is not null then 1
		else 0
		end as flu_shot_2022
FROM public.patients as pat
LEFT JOIN flu_shot_2022 as flu
	on pat.id = flu.patient
where pat.id in (select patient from active_patients)
```

### Code Explanation:
Here we used CTE's to join multiple queries. The first CTE in a query begins with "with ... as " and the following query is wrapped in parenthesis. Any following CTEs do not start with "with". 

The first CTE finds all unique patients (checked against patient ID) and filters out patients who are dead or less than 6 months old (too young for vaccine). These patients are stored as active_patients

The second CTE finds the earliest date a patient went to the hospital for a code 5302, which corresponds to a seasonal flu shot, in 2022. Some patients may have recieved multiple flu shots in our timeframe, so we use min(date) to filter out any additional visits. This is stored as flu_shot_2022. This list will return a 0 if a patient did not receive a flu shot in the timeframe and a 1 if they did. 

The last section pulls all needed columns, extracts the patients ages so we can use that for the visualization, and joins our flu_shot_2022 list to our list of patients. 
The results are exported from postgres as ImmunizationResults2.csv

### Observations:
After visualizing the results via Tableau we can easily observe our total compliance, highest- and lowest-immunized populations, and a list of patients who did not receive the shot that the hospital could use to reach out to those individuals. 
